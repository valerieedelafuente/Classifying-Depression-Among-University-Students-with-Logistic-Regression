---
title: 'Final Project - Step 2 (15 Points)'
subtitle: "PSTAT100: Data Science Concepts and Analysis" 

author:
    affiliations:
      - name: "Spring 2025"
affiliation-title: "Quarter"
format: 
 pdf: 
    latex_engine: xelatex
    geometry: "letterpaper, margin=0.3in"
    code-fold: true
    code-line-numbers: true
    code-copy: true
    code-tools: true
    self-contained: true
    toc: false
    toc-location: left
    number-sections: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(message =  FALSE)
knitr::opts_chunk$set(warning =  FALSE)
knitr::opts_chunk$set(error =  FALSE)
bfcolor <- function(x, color) {
  if (knitr::is_latex_output()) {
    sprintf("\\textcolor{%s}{\\textbf{%s}}", color, x)
  } else if (knitr::is_html_output()) {
    sprintf("<span style='color: %s;'><b>%s</b></span>", color, x)
  } else x
}
```

:::: callout
::: {style="text-align: center"}
[**STUDENT NAME**]{style="color: blue;"}
:::

-   Valerie De La Fuente (valeriedelafuente)
-   Matthew Arteaga (matthewarteaga)
-   Phuc Lu (pdlu)
-   William Nelson (williamnelson)
-   Hayden Galletta (haydengalletta)
::::

::: callout-caution
## Due Date

The deadline for this step is **Friday, May 9, 2025**.
:::

::: callout-tip
# Instructions

In this step, you will develop clear research questions and hypotheses based on your selected dataset, and conduct a thorough Exploratory Data Analysis (EDA). This foundational work is crucial for guiding your analysis in the following steps.
:::

# Step 2: Research Questions, Hypotheses, and Exploratory Data Analysis (EDA)

## Research Questions

**Question 1**

Do certain dietary habits coincide with an increased rate of depression among students?

**Question 2**

Is there a correlation between the amount of sleep a student gets and the proportion of them that are depressed?

**Question 3**

Does the presence (and magnitude) of certain stressors have an impact on the rate at which students are depressed?

## Hypotheses

**Hypothesis 1**

Students with moderate to healthy dietary habits will have lower rates of depression compared to students with unhealthy dietary habits.

**Hypothesis 2**

Students who average more sleep per night will have lower rates of depression compared to students who average less.

**Hypothesis 3**

Students with the highest collective reported stressors (`Academic Pressure + Work Pressure + Financial Stress`) will have higher rates of depression compared to students with lower collective reported stressors.

## Exploratory Data Analysis (EDA)

## Data Cleaning

### Viewing the Data

```{r, warning = FALSE}
# Load necessary packages
library(readr)
library(tidyverse)
library(naniar)
library(janitor)

# Load in the data
depression_data <- read.csv("data/student_depression_dataset.csv")

# View the dataset
head(depression_data)

# Examine the dimensions
dim(depression_data)
```

There are 27901 observations and 18 variables in this dataset. The list of variables is as follows:

-   `id`: A unique identifier assigned to each student record in the dataset.

-   `Gender`: The gender of the student (e.g., Male, Female, Other). This helps in analyzing gender-specific trends in mental health.

-   `Age`: The age of the student in years.

-   `City`: The city or region where the student resides, providing geographical context for the analysis.

-   `Profession`: The field of work or study of the student, which may offer insights into occupational or academic stress factors.

-   `Academic Pressure`: A measure indicating the level of pressure the student faces in academic settings. This could include stress from exams, assignments, and overall academic expectations.

-   `Work Pressure`: A measure of the pressure related to work or job responsibilities, relevant for students who are employed alongside their studies.

-   `CGPA`: The cumulative grade point average of the student, reflecting overall academic performance.

-   `Study Satisfaction`: An indicator of how satisfied the student is with their studies, which can correlate with mental well-being.

-   `Job Satisfaction`: A measure of the student’s satisfaction with their job or work environment, if applicable.

-   `Sleep Duration`: The average number of hours the student sleeps per day, which is an important factor in mental health.

-   `Dietary Habits`: An assessment of the student’s eating patterns and nutritional habits, potentially impacting overall health and mood.

-   `Degree`: The academic degree or program that the student is pursuing.

-   `Have you ever had suicidal thoughts?`: A binary indicator (Yes/No) that reflects whether the student has ever experienced suicidal ideation.

-   `Work/Study Hours`: The average number of hours per day the student dedicates to work or study, which can influence stress levels.

-   `Financial Stress`: A measure of the stress experienced due to financial concerns, which may affect mental health.

-   `Family History of Mental Illness`: A measure of the stress experienced due to financial concerns, which may affect mental health.

-   `Depression`: The target variable that indicates whether the student is experiencing depression (Yes/No). This is the primary focus of the analysis.

### Fixing Column Names

```{r}
# Fix column names
depression_data <- depression_data %>% 
  clean_names() %>%
  rename(
    cum_gpa = cgpa,
    suicidal_thoughts = have_you_ever_had_suicidal_thoughts,
    fam_mental_illness = family_history_of_mental_illness
  )

# Check if names were fixed
names(depression_data)
```

### Missing Data

```{r}
# View missing data
sum(is.na(depression_data))
```

On the surface, there is no missing data. However, when looking at the categories and their unique values, there are some signs of missingness.

For example, some categories have the `Other` category. Since there is not way of figuring out what `Other` mean precisely, it can be considered as an unknown category. To deal with this, it won't remove but will still be concluded to not harm the data integrity.

Besides the other category, there is one variable that encodes its missing value as `?`. This is a placeholder for missing value under the `financial stress` variable. We'll deal with this by encoding it as `NA`.

```{r}
# Fixing the `financial_stress` variable
depression_data <- depression_data %>%
  mutate(
    financial_stress = as.numeric(financial_stress), 
    # convert string numbers to integers
    financial_stress = case_when(
      financial_stress == "?" ~ NA,
      # convert "?" to NA values
      .default = financial_stress))

sum(is.na(depression_data))
```

Now, the total number of missing observation is 3, which comes from the `financial stress` variable.

```{r}
library(naniar)
depression_data %>% vis_miss()
```

This missingness only makes up $\frac{3}{27,901}$ values or much less than 0.1% of the data set. We can simply remove these values without a problem.

```{r}
depression_data <- depression_data %>% na.omit()
depression_data %>% dim()
```

### Checking Data Types

```{r}
# Check data types of the variables
str(depression_data)
```

According to the output, we must mutate some variables. This includes factorization and fixing some values that the variables take in.

### Mutating Variables

```{r}
# Factorizing the `gender` variable
depression_data$gender <- factor(depression_data$gender)

# Fixing the `city` variable to change invalid entries
depression_data <- depression_data %>%
  mutate(city = case_when(
    city == "Khaziabad" ~ "Ghaziabad",
    city == "Nalyan" ~ "Kalyan",
    city == "'Less Delhi'" ~ "Delhi",
    city == "'Less than 5 Kalyan'" ~ "Kalyan",
    city == "3.0" ~ "Other",
    city == "Saanvi" ~ "Other",
    city == "M.Tech" ~ "Other",
    city == "Bhavna" ~ "Other",
    city == "City" ~ "Other",
    city == "Mira" ~ "Other",
    city == "Harsha" ~ "Other",
    city == "Vaanya" ~ "Other",
    city == "Gaurav" ~ "Other",
    city == "Harsh" ~ "Other",
    city == "Reyansh" ~ "Other",
    city == "Kibara" ~ "Other",
    city == "Rashi" ~ "Other",
    city == "ME" ~ "Other",
    city == "M.Com" ~ "Other",
    city == "Mihir" ~ "Other",
    city == "Nalini" ~ "Other",
    city == "Nandini" ~ "Other",
    TRUE ~ city  # Leave valid entries as they are
  ))

# # Fixing the `profession` variable to change invalid entries
depression_data <- depression_data %>%
  mutate(profession = case_when(
    profession == "'Civil Engineer'" ~ "Civil Engineer",
    profession == "'UX/UI Designer'" ~ "UX/UI Designer",
    profession == "'Digital Marketer'" ~ "Digital Marketer",
    profession == "'Content Writer'" ~ "Content Writer",
    profession == "'Educational Consultant'" ~ "Educational Consultant",
    TRUE ~ profession # Leave valid entries as they are
  ))


# Fixing the `work_pressure` variable for proper scaling
depression_data <- depression_data %>%
  mutate(work_pressure = case_when(
    work_pressure == 0 ~ 0,
    work_pressure == 2 ~ 1,
    work_pressure == 5 ~ 3
  ))

# Fixing the `sleep_duration` variable to change invalid entries
depression_data <- depression_data %>% 
  mutate(sleep_duration = case_when(
    sleep_duration == "'5-6 hours'" ~ "5-6 hours",
    sleep_duration == "'Less than 5 hours'" ~ "Less than 5 hours",
    sleep_duration == "'7-8 hours'" ~ "7-8 hours",
    sleep_duration == "'More than 8 hours'" ~ "More than 8 hours",
    sleep_duration == "Others" ~ "Other"
  ))

# Factorizing the `sleep_duration` variable
depression_data <- depression_data %>%
  mutate(sleep_duration = factor(sleep_duration, 
                                 levels = c("Less than 5 hours", 
                                            "5-6 hours", 
                                            "7-8 hours", 
                                            "More than 8 hours", 
                                            "Other"),
                                 ordered = TRUE))

# Fixing the `dietary_habits` variable to change misspelling
depression_data <- depression_data %>% 
  mutate(dietary_habits = case_when(
    dietary_habits == "Others" ~ "Other",
    TRUE ~ dietary_habits
  ))

# Factorizing the `dietary_habits` variable
depression_data <- depression_data %>%
  mutate(dietary_habits = factor(dietary_habits,
                                 levels = c("Healthy", "Moderate", "Unhealthy",
                                            "Other"),
                                 ordered = TRUE))

# Fixing the `degree` variable to change invalid entries
depression_data <- depression_data %>%
  mutate(degree = case_when(
    degree == "'Class 12'" ~ "High School",
    degree == "Others" ~ "Other",  
    # Others could less than HS education or totally unknown. 
    .default = degree
  ))

# Factorizing the `degree variable`
degree_levels <- c(
  "High School",
  "BA", "BSc", "B.Com", "BCA", "B.Pharm", "B.Ed", "B.Tech", "BE", "BHM", "B.Arch", "BBA",
  "MA", "MSc", "MBA", "M.Com", "MCA", "M.Tech", "M.Ed", "M.Pharm", "MHM",
  "LLB", "LLM", "MD", "MBBS",
  "PhD",
  "Other"
)
depression_data <- depression_data %>%
  mutate(degree = factor(degree, levels = degree_levels, ordered = TRUE))

# Factorizing the `suicidal_thoughts` variable
depression_data$suicidal_thoughts <- factor(depression_data$suicidal_thoughts)

# Factorizing the `fam_mental_illness` variable
depression_data$fam_mental_illness <- factor(depression_data$fam_mental_illness)

# Turning the `depression` variable back to "yes" and "no" for visualization purposes
depression_data <- depression_data %>% 
  mutate(depression = case_when(
    depression == 0 ~ "No",
    depression == 1 ~ "Yes"
  ))

# Factorizing the `depression` variable
depression_data$depression <- factor(depression_data$depression)

# Check data types of the variables again to ensure everything was properly done
str(depression_data)
```

According to the output, the data was successfully cleaned and the variables are ready for visualization.

## Descriptive Statistics

#### Correlation Plot of Numeric Variables

```{r}
library(corrplot)
cor(depression_data %>% select_if(is.numeric)) %>% corrplot(type="lower", diag = FALSE, method = "number")
```

There is a large correlation of 0.77 between the responses of "Job Satisfaction" and "Work Pressure". We should explore this correlation:

```{r}
table(depression_data$work_pressure)
table(depression_data$job_satisfaction)
```

Nearly all the students responded they have the lowest level (0) of both Work Pressure and Job Satisfaction. This likely means the students do not have jobs and are full-time students.

#### Age

```{r}
summary(depression_data$age)
```

Students have a mean age of about 26 years old, with the large majority of students being between 18 and 30 years old.

#### GPA

```{r}
summary(depression_data$cum_gpa)
# There are a handful of students with 0 GPA
# This slightly affects mean but minimally

depression_data %>% filter(cum_gpa != 0) %>% 
  select(cum_gpa) %>% 
  summary()
```

On this GPA scale where the minimum seems to be 5 or lower and the maximum is 10, students have an average GPA of about 7.7.

#### Depression

```{r}
round(prop.table(table(depression_data$depression)), digits = 3)
```

We see just below 60% of students responded they experience Depression.

#### Suicidal Thoughts

```{r}
round(prop.table(table(depression_data$suicidal_thoughts)), digits = 3)
```

We see 63.3% of students respond they have had suicidal thoughts.

#### Family Mental Illness

```{r}
round(prop.table(table(depression_data$fam_mental_illness)), digits = 3)
```

It is nearly an even split between responses for the presence of mental illness in the student's family, with a slightly higher frequency of "No" responses.

#### Work Study Hours

```{r}
summary(depression_data$work_study_hours)
```

#### Dietary Habits

```{r}
round(prop.table(table(depression_data$dietary_habits)), digits = 4)
```

More students have moderate and unhealthy dietary habits than healthy dietary habits.

#### Sleep Duration

```{r}
round(prop.table(table(depression_data$sleep_duration)), digits = 3)
```

We see that almost a third of students said they get less than 5 hours of sleep on average.

#### Academic Pressure

```{r}
round(prop.table(table(depression_data$academic_pressure)), digits = 4)
```

There seems to be a pretty even distribution of responses for Academic Pressure, with the highest frequency of responses in 3, 5, and 4 respectively.

#### Financial Stress

```{r}
round(prop.table(table(depression_data$financial_stress)), digits = 3)
```

The distribution of responses for Financial Stress appears very uniform, with each level receiving almost one fifth of the responses, but the highest frequency of responses was for the highest level of Financial Stress.

#### Study Satisfaction

```{r}
round(prop.table(table(depression_data$study_satisfaction)), digits = 4)
```

The distribution of responses for Study Satisfaction are similarly quite uniform, with a small decrease in responses for the highest level of Study Satisfaction.

## Data Visualization

-   Depression by Dietary Habits

```{r}
depression_data %>% 
  ggplot(aes(x=dietary_habits, fill = depression)) + 
  geom_bar(position = "dodge") + 
  labs(x = "Dietary Habits", y = "Number of Students",
       title = "Presence of Depression by Dietary Habits",
       fill = "Presence of Depression")

depression_data %>% 
  filter(dietary_habits != "Other") %>% 
  ggplot(aes(x=dietary_habits, fill = depression)) + 
  geom_bar(position = "dodge") + 
  labs(x = "Dietary Habits", y = "Number of Students",
       title = "Presence of Depression by Dietary Habits",
       fill = "Presence of Depression")
```

-   Depression by Sleep

```{r}
depression_data %>% 
  ggplot(aes(x=sleep_duration, fill = depression)) + 
  geom_bar(position = "dodge") + 
  labs(x = "Sleep Duration", y = "Number of Students",
       title = "Depression by Sleep Duration",
       fill = "Depression")

depression_data %>% 
  filter(sleep_duration != "Other") %>% 
  ggplot(aes(x=sleep_duration, fill = depression)) + 
  geom_bar(position = "dodge") + 
  labs(x = "Sleep Duration", y = "Number of Students",
       title = "Depression by Sleep Duration",
       fill = "Depression")
```

-   Depression by Academic Pressure

```{r}
depression_data %>% 
  ggplot(aes(x=academic_pressure, fill = depression)) + 
  geom_bar(position = "dodge") + 
  labs(x = "Academic Pressure 0-5 (0 = No Pressure)", y = "Number of Students",
       title = "Depresion by Academic Pressure",
       fill = "Depression")

depression_data %>% 
  mutate(academic_pressure = case_when(
    academic_pressure == 0 ~ 1,
    TRUE ~ academic_pressure)) %>% 
  ggplot(aes(x=academic_pressure, fill = depression)) + 
  geom_bar(position = "dodge") + 
  labs(x = "Academic Pressure 1-5 (1 = Least Pressure)", y = "Number of Students",
       title = "Depresion by Academic Pressure",
       fill = "Depression")

depression_data %>% 
  ggplot(aes(x = depression, y = academic_pressure)) +
    geom_boxplot(alpha = 0)
```

-   Depression by Financial Stress

```{r}
depression_data %>% 
  ggplot(aes(x=financial_stress, fill = depression)) + 
  geom_bar(position = "dodge") + 
  labs(x = "Financial Stress 1-5 (0 = Least Stress)", y = "Number of Students",
       title = "Depresion by Financial Stress",
       fill = "Depression")

depression_data %>% 
  ggplot(aes(x = depression, y = financial_stress)) +
    geom_boxplot(alpha = 0)
```

## Data Visualization (Hayden)

This first graph is a bar plot that helps to answer hypothesis 1 by visualizing the correlation between a healthy diet and depression. The results of this bar plot clearly indicate a strong correlation with a unhealthy diet and rates of depression. 

```{r}
# For dietary habits
ggplot(depression_data, aes(x = dietary_habits, fill = factor(depression))) +
  geom_bar(position = "fill", color = "black") +
  scale_y_continuous(labels = scales::percent) +
  labs(title = "Depression Distribution by Dietary Habit",
       x = "Dietary Habit", y = "Proportion",
       fill = "Depression") +
  theme_bw(base_size = 12) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```


The second graph is a bar plot that helps to answer hypothesis 2 by visualizing the correlation between sleep patterns and depression. The results of this bar plot seem to indicate that people getting less than 5 hours of sleep have a significantly higher rate of depression and people who get more than 8 hours of sleep have a significantly lower rate of depression. 

```{r}
# Convert 'depression' factor to numeric: "No" = 0, "Yes" = 1
depression_data <- depression_data %>%
  mutate(depression_numeric = as.numeric(depression) - 1)

# Create summarized depression rates and standard errors by sleep duration
sleep_summary <- depression_data %>%
  group_by(sleep_duration) %>%
  summarise(
    mean_dep = mean(depression_numeric, na.rm = TRUE),
    se = sd(depression_numeric, na.rm = TRUE) / sqrt(n())
  )

# Bar plot with error bars
ggplot(sleep_summary, aes(x = sleep_duration, y = mean_dep, fill = sleep_duration)) +
  geom_col(show.legend = FALSE) +

  labs(
    title = "Depression Rate by Sleep Duration",
    x = "Sleep Duration",
    y = "Mean Depression Rate"
  ) +
  theme_minimal(base_size = 13) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

This final graph is a boxplot that helps visualize hypothesis 3 and shows the correlation between multiple stressor factors and depression. The results seem to indicate a correlation with the total stressors and depression.

```{r}
depression_data$financial_stress <- as.numeric(depression_data$financial_stress)
depression_data$total_stress <- depression_data$academic_pressure +
                                 depression_data$work_pressure +
                                 depression_data$financial_stress

ggplot(depression_data, aes(x = factor(depression), y = total_stress, fill = factor(depression))) +
  geom_boxplot() +
  labs(title = "Total Reported Stress vs Depression", x = "Depression (0 = No, 1 = Yes)", y = "Total Stress") +
  theme_minimal()
```

